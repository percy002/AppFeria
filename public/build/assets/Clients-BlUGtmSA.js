import{A as H}from"./AuthenticatedLayout-DpnaLYEW.js";import{r as o,q as S,a as k}from"./app-DzJNCemg.js";import{T as t,G as P,B as C,M as p,L as h,S as A,a as B,b as f,H as x}from"./Toast-DAXrZqWn.js";import"./jsx-runtime-CoOgG5aM.js";import{C as b,a as N}from"./ClientContext-BeGHC0JD.js";import{S as v}from"./sweetalert2.all-4F1A6Uy4.js";import{C as _}from"./Card-CYoVPnyf.js";import{M as T}from"./ModalObservacionesPago-CTW1WA4i.js";import"./transition-Cbx_lerg.js";function F({cliente:e}){var r;o.useState(e.approved);const[a,l]=o.useState(e.evaluated),{evaluatedClients:E,setEvaluatedClients:i}=o.useContext(b),{clients:m,setClients:u}=o.useContext(N),s=async n=>{try{const c=await axios.put(`/cliente/${n}/evaluar`,null);if(c.status===200){const g=c.data;return i(R=>[...R,e]),l(g.approved),u(m.filter(R=>R.id!=n)),"el cliente ah sido evaluad correctamente"}else return console.error("Error al cambiar el estado de evaluación del cliente:",c.statusText),"Error al evaluar al cliente ".response.statusText}catch(c){return console.error("Error al cambiar el estado de evaluación del cliente:",c),"Error al evaluar al cliente ".error}},d=async n=>{v.fire({title:"¿Esta seguro de evaluar a este cliente?",text:"se cambiara el estado de este cliente a cliente evaluado",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, evaluar!",cancelButtonText:"Cancelar"}).then(async c=>{c.isConfirmed&&(await s(n),v.fire({title:"Cliente evaluado correctamente",icon:"success"}))})};return React.createElement(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800"},e?React.createElement(React.Fragment,null,React.createElement(t.Cell,null,(r=e.category)==null?void 0:r.name),React.createElement(t.Cell,null,e.ruc),React.createElement(t.Cell,null,e.company_name),React.createElement(t.Cell,null,e.name," ",e.last_name),React.createElement(t.Cell,null,e.dni),React.createElement(t.Cell,null,e.position),React.createElement(t.Cell,null,e.email),React.createElement(t.Cell,null,React.createElement("input",{type:"checkbox",checked:a,onChange:()=>{d(e.id)}}),a?React.createElement("span",{className:"ml-2"},"Revisado"):"")):React.createElement(t.Cell,{colSpan:"8"},"Cargando..."))}function I({clientes:e}){return React.createElement("div",{className:"overflow-x-auto"},React.createElement(t,{striped:!0},React.createElement(t.Head,null,React.createElement(t.HeadCell,null,"Categoría"),React.createElement(t.HeadCell,null,"RUC"),React.createElement(t.HeadCell,null,"Razón Social"),React.createElement(t.HeadCell,null,"Nombres y Apellidos"),React.createElement(t.HeadCell,null,"DNI"),React.createElement(t.HeadCell,null,"Cargo"),React.createElement(t.HeadCell,null,"Email"),React.createElement(t.HeadCell,null,"En Evaluación")),React.createElement(t.Body,{className:"divide-y"},e.map(a=>React.createElement(F,{cliente:a,key:a.id})))))}function M(e){return P({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10.75 10.818v2.614A3.13 3.13 0 0011.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 00-1.138-.432zM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 00-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152z"}},{tag:"path",attr:{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-6a.75.75 0 01.75.75v.316a3.78 3.78 0 011.653.713c.426.33.744.74.925 1.2a.75.75 0 01-1.395.55 1.35 1.35 0 00-.447-.563 2.187 2.187 0 00-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 11-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 111.359-.636c.08.173.245.376.54.569.313.205.706.353 1.138.432v-2.748a3.782 3.782 0 01-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.097-2.096a3.78 3.78 0 011.653-.713V4.75A.75.75 0 0110 4z",clipRule:"evenodd"}}]})(e)}const O=({payment:e,updateState:a,updatePaymentStatusObs:l})=>{const[E,i]=o.useState(!1),[m,u]=o.useState("El pago no coincide"),[s,d]=o.useState(""),r=()=>{const n={payment_id:e.id,observaciones:m,detalleObservaciones:s};axios.post(route("observarPago"),n).then(c=>{l({status:"observado",observations:m,observations_detail:s}),i(!1),a(!1)}).catch(c=>{})};return React.createElement(React.Fragment,null,React.createElement(C,{onClick:()=>i(!0)},"Agregar Observación"),React.createElement(p,{show:E,onClose:()=>i(!1)},React.createElement(p.Header,null,"Observaciones en el pago de reserva"),React.createElement(p.Body,null,React.createElement("div",{className:"max-w-md"},React.createElement("div",{className:"mb-2 block"},React.createElement(h,{htmlFor:"countries",value:"Seleccione una observación"})),React.createElement(A,{id:"countries",required:!0,onChange:n=>u(n.target.value)},React.createElement("option",null,"El pago no coincide"),React.createElement("option",null,"No se abono a la cuenta(verifique con su banco)"),React.createElement("option",null,"otro"))),m=="otro"&&React.createElement("div",{className:"max-w-md"},React.createElement("div",{className:"mb-2 block"},React.createElement(h,{htmlFor:"observaciones",value:"Agregar Observaciones"})),React.createElement(B,{id:"observaciones",placeholder:"Deja una observación",required:!0,rows:4,onChange:n=>{d(n.target.value)},value:s}))),React.createElement(p.Footer,null,React.createElement(C,{onClick:r},"Agregar observación de pago"),React.createElement(C,{color:"gray",onClick:()=>i(!1)},"Cancelar"))))};function D({stands:e,payment:a,updatePaymentStatus:l,clientId:E,name:i,category:m}){const[u,s]=o.useState(!1);S().props;const d=()=>{const r={payment_id:a.id,client_id:E};v.fire({title:"¿Esta seguro de confirmar este pago?",text:"Se Creara un credencial, factura y contrato para el usuario seleccionado!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Confirmar!",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&axios.post(route("validarPago"),r).then(c=>{s(!1),l({status:"aceptado"}),v.fire({title:"Pago Aceptado",text:"El pago ha sido aceptado correctamente!",icon:"success"})}).catch(c=>{v.fire({title:"Error!",text:"Ha ocurrido un error al intentar validar el pago, por favor intente nuevamente.",icon:"error"})})})};return React.createElement(React.Fragment,null,React.createElement(C,{onClick:()=>s(!0)},"Ver Pago"),React.createElement(p,{dismissible:!0,show:u,onClose:()=>s(!1),size:"7xl"},React.createElement(p.Header,null,"Validar Pago"),React.createElement(p.Body,null,React.createElement("div",{className:"flex justify-center flex-col md:flex-row"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"space-y-6"},React.createElement("p",null,"usuario: ",i),React.createElement("p",null,"Categoría: ",m)),e&&e.map(r=>React.createElement(_,{className:"m-1 card_padding px-8",key:r.id},React.createElement("div",{className:"flex justify-between"},React.createElement("p",null,"bloque : ",r.block),React.createElement("p",null,"Stand : ",r.name),React.createElement("p",null,"precio : ",r.price)))),React.createElement("div",{className:"flex justify-between p-8"},React.createElement("div",{className:""},React.createElement("p",null,"Cantidad: ",e.length," ")),React.createElement("div",{className:""},React.createElement("p",null,"Total:"," ",e.reduce((r,n)=>r+n.price,0))))),React.createElement("div",{className:"flex-1"},a&&React.createElement("div",{className:""},React.createElement("p",null,"pagado"),a.payment_method!="culqi"&&(()=>{const r=a.file.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(r)?React.createElement("img",{src:`http://localhost:8000/storage/${a.file}`,alt:"Payment",className:"w-[80%]"}):r==="pdf"?React.createElement("embed",{src:`http://localhost:8000/storage/${a.file}`,type:"application/pdf",width:"100%",height:"600px"}):React.createElement("p",null,"Archivo no soportado")})())))),(a==null?void 0:a.payment_method)!=="culqi"&&React.createElement(p.Footer,{className:""},React.createElement(C,{color:"blue",onClick:d},"Validar Pago"),React.createElement(O,{payment:a,updateState:s,updatePaymentStatusObs:l}),React.createElement(C,{color:"success",onClick:()=>s(!1)},"cerrar"))))}const z=({cliente:e})=>{var m,u,s,d,r,n,c,g;const a=(n=(u=(m=e.reservation[0])==null?void 0:m.payment)==null?void 0:u.payment_status)==null?void 0:n[((r=(d=(s=e.reservation[0])==null?void 0:s.payment)==null?void 0:d.payment_status)==null?void 0:r.length)-1],[l,E]=o.useState(a);function i(R){E(w=>({...w,...R}))}return console.log(e),React.createElement(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800"},e?React.createElement(React.Fragment,null,React.createElement(t.Cell,null,(c=e.category)==null?void 0:c.name),React.createElement(t.Cell,null,e.ruc),React.createElement(t.Cell,null,e.company_name),React.createElement(t.Cell,null,e.name," ",e.last_name),React.createElement(t.Cell,null,e.dni),React.createElement(t.Cell,null,e.position),React.createElement(t.Cell,null,e.email),React.createElement(t.Cell,null,e.reservation&&e.reservation.length>0&&React.createElement(D,{stands:e.reservation[0].stands,payment:e.reservation[0].payment,updatePaymentStatus:i,clientId:e.id,name:e.name+" "+e.last_name,category:(g=e.category)==null?void 0:g.name})),React.createElement(t.Cell,null,l&&l.status=="observado"?React.createElement(T,{paymentStatus:l}):l&&l.status?l.status:"En Proceso"),React.createElement(t.Cell,null,l&&l.status=="aceptado"&&React.createElement("div",{className:"flex flex-col gap-2"},React.createElement(C,{as:"a",href:route("generateFotoCheckPDF",{clientId:e.reservation[0].cliente_id,reservationId:e.reservation[0].id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Credenciales"),React.createElement(C,{as:"a",href:route("generateInvoicePDF",{clientId:e.reservation[0].cliente_id,reservationId:e.reservation[0].id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Recibo"),React.createElement(C,{as:"a",href:route("generateContractPDF",{clientId:e.reservation[0].cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Contrato")))):React.createElement(t.Cell,{colSpan:"8"},"Cargando..."))},V=({clientes:e})=>React.createElement("div",{className:"overflow-x-auto"},React.createElement(t,{striped:!0},React.createElement(t.Head,null,React.createElement(t.HeadCell,null,"Categoría"),React.createElement(t.HeadCell,null,"RUC"),React.createElement(t.HeadCell,null,"Razón Social"),React.createElement(t.HeadCell,null,"Nombres y Apellidos"),React.createElement(t.HeadCell,null,"DNI"),React.createElement(t.HeadCell,null,"Cargo"),React.createElement(t.HeadCell,null,"Email"),React.createElement(t.HeadCell,null,"Opciones"),React.createElement(t.HeadCell,null,"Revision de Pagos"),React.createElement(t.HeadCell,null,"Documentos")),React.createElement(t.Body,{className:"divide-y"},e&&e.length>0&&e.map(a=>React.createElement(z,{cliente:a,key:a.id}))))),y=o.createContext([]);function j({cliente:e}){var r;const[a,l]=o.useState(e.approved),{approvedClients:E,setApprovedClients:i}=o.useContext(y),{evaluatedClients:m,setEvaluatedClients:u}=o.useContext(b),s=async n=>{try{const c=await axios.put(`/cliente/${n}/aprobar`,null);if(c.status===200){const g=c.data;return i(R=>[...R,e]),l(g.approved),u(m.filter(R=>R.id!=n)),"el cliente ah sido aprobado correctamente"}else return console.error("Error al cambiar el estado del cliente:",c.statusText),"Error al evaluar al cliente ".response.statusText}catch(c){return console.error("Error al cambiar el estado del cliente:",c),"Error al aprobar al cliente ".error}},d=async n=>{v.fire({title:"¿Esta seguro de aprobar a este cliente?",text:"se cambiara el estado de este cliente a cliente aprobado",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, aprobar!",cancelButtonText:"Cancelar"}).then(async c=>{c.isConfirmed&&(await s(n),v.fire({title:"Cliente aprobado correctamente",icon:"success"}))})};return React.createElement(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800"},e?React.createElement(React.Fragment,null,React.createElement(t.Cell,null,(r=e.category)==null?void 0:r.name),React.createElement(t.Cell,null,e.ruc),React.createElement(t.Cell,null,e.company_name),React.createElement(t.Cell,null,e.name," ",e.last_name),React.createElement(t.Cell,null,e.dni),React.createElement(t.Cell,null,e.position),React.createElement(t.Cell,null,e.email),React.createElement(t.Cell,null,React.createElement("input",{type:"checkbox",checked:a,onChange:()=>{d(e.id)}}),a?React.createElement("span",{className:"ml-2"},"Aprobado"):"")):React.createElement(t.Cell,{colSpan:"8"},"Cargando..."))}function q(){const{evaluatedClients:e,setEvaluatedClients:a}=o.useContext(b);return console.log(e),React.createElement("div",{className:"overflow-x-auto"},React.createElement(t,{striped:!0},React.createElement(t.Head,null,React.createElement(t.HeadCell,null,"Categoría"),React.createElement(t.HeadCell,null,"RUC"),React.createElement(t.HeadCell,null,"Razón Social"),React.createElement(t.HeadCell,null,"Nombres y Apellidos"),React.createElement(t.HeadCell,null,"DNI"),React.createElement(t.HeadCell,null,"Cargo"),React.createElement(t.HeadCell,null,"Email"),React.createElement(t.HeadCell,null,"Estado")),React.createElement(t.Body,{className:"divide-y"},e&&e.map(l=>React.createElement(j,{cliente:l,key:l.id})))))}function U({cliente:e}){var a;return o.useState(e.approved),o.useState(e.evaluated),React.createElement(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800"},e?React.createElement(React.Fragment,null,React.createElement(t.Cell,null,(a=e.category)==null?void 0:a.name),React.createElement(t.Cell,null,e.ruc),React.createElement(t.Cell,null,e.company_name),React.createElement(t.Cell,null,e.name," ",e.last_name),React.createElement(t.Cell,null,e.dni),React.createElement(t.Cell,null,e.position),React.createElement(t.Cell,null,e.email)):React.createElement(t.Cell,{colSpan:"8"},"Cargando..."))}function $(){const{approvedClients:e,setApprovedClients:a}=o.useContext(y);return React.createElement("div",{className:"overflow-x-auto"},React.createElement(t,{striped:!0},React.createElement(t.Head,null,React.createElement(t.HeadCell,null,"Categoría"),React.createElement(t.HeadCell,null,"RUC"),React.createElement(t.HeadCell,null,"Razón Social"),React.createElement(t.HeadCell,null,"Nombres y Apellidos"),React.createElement(t.HeadCell,null,"DNI"),React.createElement(t.HeadCell,null,"Cargo"),React.createElement(t.HeadCell,null,"Email")),React.createElement(t.Body,{className:"divide-y"},e&&e.map(l=>React.createElement(U,{cliente:l,key:l.id})))))}const L={tablist:{tabitem:{base:"flex items-center justify-center rounded-t-lg p-4 text-sm font-medium first:ml-0  disabled:cursor-not-allowed disabled:text-gray-400 disabled:dark:text-gray-500"}}};async function G(){return(await axios.get(route("clientes.registrados"))).data.registeredClients}async function J(){return(await axios.get(route("clientes.evaluados"))).data.evaluatedClients}async function K(){const e=await axios.get(route("clientes.aprobados"));return console.log(e.data),e.data.approvedClients}const re=({auth:e,clientes:a,clientesPagos:l})=>{const[E,i]=o.useState([]),[m,u]=o.useState([]),[s,d]=o.useState([]);return o.useEffect(()=>{G().then(d),J().then(i),K().then(u),console.log(s)},[]),React.createElement(N.Provider,{value:{clients:s,setClients:d}},React.createElement(b.Provider,{value:{evaluatedClients:E,setEvaluatedClients:i}},React.createElement(y.Provider,{value:{approvedClients:m,setApprovedClients:u}},React.createElement(H,{user:e.user,client:e.cliente},React.createElement(k,{title:"Clientes"}),React.createElement(f,{"aria-label":"Default tabs",style:"underline",theme:L},React.createElement(f.Item,{active:!0,title:"Clientes Registrados",icon:x},React.createElement("div",{className:"mt-4 container mx-auto"},React.createElement("h2",{className:"font-semibold text-xl text-gray-800 leading-tight"},"Todos los clientes"),React.createElement(I,{clientes:s}))),React.createElement(f.Item,{active:!0,title:"Clientes Evaluados",icon:x},React.createElement("div",{className:"mt-4 container mx-auto"},React.createElement("h2",{className:"font-semibold text-xl text-gray-800 leading-tight"},"Clientes Evaluados"),React.createElement(q,{clientes:E}))),React.createElement(f.Item,{active:!0,title:"Clientes Aprobados",icon:x},React.createElement("div",{className:"mt-4 container mx-auto"},React.createElement("h2",{className:"font-semibold text-xl text-gray-800 leading-tight"},"Clientes Aprobados"),React.createElement($,{clientes:m}))),React.createElement(f.Item,{active:!0,title:"Pagos de Clientes",icon:M},React.createElement("div",{className:"mt-4 container mx-auto"},React.createElement("h2",{className:"font-semibold text-xl text-gray-800 leading-tight"},"Todos los clientes"),React.createElement(V,{clientes:l}))))))))};export{re as default};
