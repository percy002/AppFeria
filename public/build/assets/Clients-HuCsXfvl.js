import{r as i,j as e,q as S,a as k}from"./app-CC0jckWs.js";import{A as P}from"./AuthenticatedLayout-DWXZgT2M.js";import{T as s,G as A,B as m,M as p,L as w,S as B,a as _,b as f,H as y}from"./Toast-CZeBGyVr.js";import{C as b,a as H}from"./ClientContext-DLa5cwVa.js";import{S as v}from"./sweetalert2.all-Bi5WDZWc.js";import{C as R}from"./Card-D0LgPL7A.js";import{M as T}from"./ModalObservacionesPago-DyFkhUtd.js";import"./transition-B4Xjgr4-.js";function F({cliente:a}){var t;i.useState(a.approved);const[r,l]=i.useState(a.evaluated),{evaluatedClients:j,setEvaluatedClients:c}=i.useContext(b),{clients:x,setClients:h}=i.useContext(H),d=async n=>{try{const o=await axios.put(`/cliente/${n}/evaluar`,null);if(o.status===200){const g=o.data;return c(C=>[...C,a]),l(g.approved),h(x.filter(C=>C.id!=n)),"el cliente ah sido evaluad correctamente"}else return console.error("Error al cambiar el estado de evaluación del cliente:",o.statusText),"Error al evaluar al cliente ".response.statusText}catch(o){return console.error("Error al cambiar el estado de evaluación del cliente:",o),"Error al evaluar al cliente ".error}},u=async n=>{v.fire({title:"¿Esta seguro de evaluar a este cliente?",text:"se cambiara el estado de este cliente a cliente evaluado",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, evaluar!",cancelButtonText:"Cancelar"}).then(async o=>{o.isConfirmed&&(await d(n),v.fire({title:"Cliente evaluado correctamente",icon:"success"}))})};return e.jsx(s.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:a?e.jsxs(e.Fragment,{children:[e.jsx(s.Cell,{children:(t=a.category)==null?void 0:t.name}),e.jsx(s.Cell,{children:a.ruc}),e.jsx(s.Cell,{children:a.company_name}),e.jsxs(s.Cell,{children:[a.name," ",a.last_name]}),e.jsx(s.Cell,{children:a.dni}),e.jsx(s.Cell,{children:a.position}),e.jsx(s.Cell,{children:a.email}),e.jsxs(s.Cell,{children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>{u(a.id)}}),r?e.jsx("span",{className:"ml-2",children:"Revisado"}):""]})]}):e.jsx(s.Cell,{colSpan:"8",children:"Cargando..."})})}function I({clientes:a}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(s,{striped:!0,children:[e.jsxs(s.Head,{children:[e.jsx(s.HeadCell,{children:"Categoría"}),e.jsx(s.HeadCell,{children:"RUC"}),e.jsx(s.HeadCell,{children:"Razón Social"}),e.jsx(s.HeadCell,{children:"Nombres y Apellidos"}),e.jsx(s.HeadCell,{children:"DNI"}),e.jsx(s.HeadCell,{children:"Cargo"}),e.jsx(s.HeadCell,{children:"Email"}),e.jsx(s.HeadCell,{children:"En Evaluación"})]}),e.jsx(s.Body,{className:"divide-y",children:a.map(r=>e.jsx(F,{cliente:r},r.id))})]})})}function M(a){return A({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10.75 10.818v2.614A3.13 3.13 0 0011.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 00-1.138-.432zM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 00-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152z"}},{tag:"path",attr:{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-6a.75.75 0 01.75.75v.316a3.78 3.78 0 011.653.713c.426.33.744.74.925 1.2a.75.75 0 01-1.395.55 1.35 1.35 0 00-.447-.563 2.187 2.187 0 00-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 11-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 111.359-.636c.08.173.245.376.54.569.313.205.706.353 1.138.432v-2.748a3.782 3.782 0 01-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.097-2.096a3.78 3.78 0 011.653-.713V4.75A.75.75 0 0110 4z",clipRule:"evenodd"}}]})(a)}const O=({payment:a,updateState:r,updatePaymentStatusObs:l})=>{const[j,c]=i.useState(!1),[x,h]=i.useState("El pago no coincide"),[d,u]=i.useState(""),t=()=>{const n={payment_id:a.id,observaciones:x,detalleObservaciones:d};axios.post(route("observarPago"),n).then(o=>{l({status:"observado",observations:x,observations_detail:d}),c(!1),r(!1)}).catch(o=>{})};return e.jsxs(e.Fragment,{children:[e.jsx(m,{onClick:()=>c(!0),children:"Agregar Observación"}),e.jsxs(p,{show:j,onClose:()=>c(!1),children:[e.jsx(p.Header,{children:"Observaciones en el pago de reserva"}),e.jsxs(p.Body,{children:[e.jsxs("div",{className:"max-w-md",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(w,{htmlFor:"countries",value:"Seleccione una observación"})}),e.jsxs(B,{id:"countries",required:!0,onChange:n=>h(n.target.value),children:[e.jsx("option",{children:"El pago no coincide"}),e.jsx("option",{children:"No se abono a la cuenta(verifique con su banco)"}),e.jsx("option",{children:"otro"})]})]}),x=="otro"&&e.jsxs("div",{className:"max-w-md",children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(w,{htmlFor:"observaciones",value:"Agregar Observaciones"})}),e.jsx(_,{id:"observaciones",placeholder:"Deja una observación",required:!0,rows:4,onChange:n=>{u(n.target.value)},value:d})]})]}),e.jsxs(p.Footer,{children:[e.jsx(m,{onClick:t,children:"Agregar observación de pago"}),e.jsx(m,{color:"gray",onClick:()=>c(!1),children:"Cancelar"})]})]})]})};function D({stands:a,payment:r,updatePaymentStatus:l,clientId:j,name:c,category:x}){const[h,d]=i.useState(!1);S().props;const u=()=>{const t={payment_id:r.id,client_id:j};v.fire({title:"¿Esta seguro de confirmar este pago?",text:"Se Creara un credencial, factura y contrato para el usuario seleccionado!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Confirmar!",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&axios.post(route("validarPago"),t).then(o=>{d(!1),l({status:"aceptado"}),v.fire({title:"Pago Aceptado",text:"El pago ha sido aceptado correctamente!",icon:"success"})}).catch(o=>{v.fire({title:"Error!",text:"Ha ocurrido un error al intentar validar el pago, por favor intente nuevamente.",icon:"error"})})})};return e.jsxs(e.Fragment,{children:[e.jsx(m,{onClick:()=>d(!0),children:"Ver Pago"}),e.jsxs(p,{dismissible:!0,show:h,onClose:()=>d(!1),size:"7xl",children:[e.jsx(p.Header,{children:"Validar Pago"}),e.jsx(p.Body,{children:e.jsxs("div",{className:"flex justify-center flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{children:["usuario: ",c]}),e.jsxs("p",{children:["Categoría: ",x]})]}),a&&a.map(t=>e.jsx(R,{className:"m-1 card_padding px-8",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("p",{children:["bloque : ",t.block]}),e.jsxs("p",{children:["Stand : ",t.name]}),e.jsxs("p",{children:["precio : ",t.price]})]})},t.id)),e.jsxs("div",{className:"flex justify-between p-8",children:[e.jsx("div",{className:"",children:e.jsxs("p",{children:["Cantidad: ",a.length," "]})}),e.jsx("div",{className:"",children:e.jsxs("p",{children:["Total:"," ",a.reduce((t,n)=>t+n.price,0)]})})]})]}),e.jsx("div",{className:"flex-1",children:r&&e.jsxs("div",{className:"",children:[e.jsx("p",{children:"pagado"}),r.payment_method!="culqi"&&(()=>{const t=r.file.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(t)?e.jsx("img",{src:`http://localhost:8000/storage/${r.file}`,alt:"Payment",className:"w-[80%]"}):t==="pdf"?e.jsx("embed",{src:`http://localhost:8000/storage/${r.file}`,type:"application/pdf",width:"100%",height:"600px"}):e.jsx("p",{children:"Archivo no soportado"})})()]})})]})}),(r==null?void 0:r.payment_method)!=="culqi"&&e.jsxs(p.Footer,{className:"",children:[e.jsx(m,{color:"blue",onClick:u,children:"Validar Pago"}),e.jsx(O,{payment:r,updateState:d,updatePaymentStatusObs:l}),e.jsx(m,{color:"success",onClick:()=>d(!1),children:"cerrar"})]})]})]})}const z=({cliente:a})=>{var x,h,d,u,t,n,o,g;const r=(n=(h=(x=a.reservation[0])==null?void 0:x.payment)==null?void 0:h.payment_status)==null?void 0:n[((t=(u=(d=a.reservation[0])==null?void 0:d.payment)==null?void 0:u.payment_status)==null?void 0:t.length)-1],[l,j]=i.useState(r);function c(C){j(E=>({...E,...C}))}return console.log(a),e.jsx(s.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:a?e.jsxs(e.Fragment,{children:[e.jsx(s.Cell,{children:(o=a.category)==null?void 0:o.name}),e.jsx(s.Cell,{children:a.ruc}),e.jsx(s.Cell,{children:a.company_name}),e.jsxs(s.Cell,{children:[a.name," ",a.last_name]}),e.jsx(s.Cell,{children:a.dni}),e.jsx(s.Cell,{children:a.position}),e.jsx(s.Cell,{children:a.email}),e.jsx(s.Cell,{children:a.reservation&&a.reservation.length>0&&e.jsx(D,{stands:a.reservation[0].stands,payment:a.reservation[0].payment,updatePaymentStatus:c,clientId:a.id,name:a.name+" "+a.last_name,category:(g=a.category)==null?void 0:g.name})}),e.jsx(s.Cell,{children:l&&l.status=="observado"?e.jsx(T,{paymentStatus:l}):l&&l.status?l.status:"En Proceso"}),e.jsx(s.Cell,{children:l&&l.status=="aceptado"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(m,{as:"a",href:route("generateFotoCheckPDF",{clientId:a.reservation[0].cliente_id,reservationId:a.reservation[0].id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Credenciales"}),e.jsx(m,{as:"a",href:route("generateInvoicePDF",{clientId:a.reservation[0].cliente_id,reservationId:a.reservation[0].id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Recibo"}),e.jsx(m,{as:"a",href:route("generateContractPDF",{clientId:a.reservation[0].cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Contrato"})]})})]}):e.jsx(s.Cell,{colSpan:"8",children:"Cargando..."})})},V=({clientes:a})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(s,{striped:!0,children:[e.jsxs(s.Head,{children:[e.jsx(s.HeadCell,{children:"Categoría"}),e.jsx(s.HeadCell,{children:"RUC"}),e.jsx(s.HeadCell,{children:"Razón Social"}),e.jsx(s.HeadCell,{children:"Nombres y Apellidos"}),e.jsx(s.HeadCell,{children:"DNI"}),e.jsx(s.HeadCell,{children:"Cargo"}),e.jsx(s.HeadCell,{children:"Email"}),e.jsx(s.HeadCell,{children:"Opciones"}),e.jsx(s.HeadCell,{children:"Revision de Pagos"}),e.jsx(s.HeadCell,{children:"Documentos"})]}),e.jsx(s.Body,{className:"divide-y",children:a&&a.length>0&&a.map(r=>e.jsx(z,{cliente:r},r.id))})]})}),N=i.createContext([]);function q({cliente:a}){var t;const[r,l]=i.useState(a.approved),{approvedClients:j,setApprovedClients:c}=i.useContext(N),{evaluatedClients:x,setEvaluatedClients:h}=i.useContext(b),d=async n=>{try{const o=await axios.put(`/cliente/${n}/aprobar`,null);if(o.status===200){const g=o.data;return c(C=>[...C,a]),l(g.approved),h(x.filter(C=>C.id!=n)),"el cliente ah sido aprobado correctamente"}else return console.error("Error al cambiar el estado del cliente:",o.statusText),"Error al evaluar al cliente ".response.statusText}catch(o){return console.error("Error al cambiar el estado del cliente:",o),"Error al aprobar al cliente ".error}},u=async n=>{v.fire({title:"¿Esta seguro de aprobar a este cliente?",text:"se cambiara el estado de este cliente a cliente aprobado",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, aprobar!",cancelButtonText:"Cancelar"}).then(async o=>{o.isConfirmed&&(await d(n),v.fire({title:"Cliente aprobado correctamente",icon:"success"}))})};return e.jsx(s.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:a?e.jsxs(e.Fragment,{children:[e.jsx(s.Cell,{children:(t=a.category)==null?void 0:t.name}),e.jsx(s.Cell,{children:a.ruc}),e.jsx(s.Cell,{children:a.company_name}),e.jsxs(s.Cell,{children:[a.name," ",a.last_name]}),e.jsx(s.Cell,{children:a.dni}),e.jsx(s.Cell,{children:a.position}),e.jsx(s.Cell,{children:a.email}),e.jsxs(s.Cell,{children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>{u(a.id)}}),r?e.jsx("span",{className:"ml-2",children:"Aprobado"}):""]})]}):e.jsx(s.Cell,{colSpan:"8",children:"Cargando..."})})}function U(){const{evaluatedClients:a,setEvaluatedClients:r}=i.useContext(b);return console.log(a),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(s,{striped:!0,children:[e.jsxs(s.Head,{children:[e.jsx(s.HeadCell,{children:"Categoría"}),e.jsx(s.HeadCell,{children:"RUC"}),e.jsx(s.HeadCell,{children:"Razón Social"}),e.jsx(s.HeadCell,{children:"Nombres y Apellidos"}),e.jsx(s.HeadCell,{children:"DNI"}),e.jsx(s.HeadCell,{children:"Cargo"}),e.jsx(s.HeadCell,{children:"Email"}),e.jsx(s.HeadCell,{children:"Estado"})]}),e.jsx(s.Body,{className:"divide-y",children:a&&a.map(l=>e.jsx(q,{cliente:l},l.id))})]})})}function $({cliente:a}){var r;return i.useState(a.approved),i.useState(a.evaluated),e.jsx(s.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:a?e.jsxs(e.Fragment,{children:[e.jsx(s.Cell,{children:(r=a.category)==null?void 0:r.name}),e.jsx(s.Cell,{children:a.ruc}),e.jsx(s.Cell,{children:a.company_name}),e.jsxs(s.Cell,{children:[a.name," ",a.last_name]}),e.jsx(s.Cell,{children:a.dni}),e.jsx(s.Cell,{children:a.position}),e.jsx(s.Cell,{children:a.email})]}):e.jsx(s.Cell,{colSpan:"8",children:"Cargando..."})})}function L(){const{approvedClients:a,setApprovedClients:r}=i.useContext(N);return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(s,{striped:!0,children:[e.jsxs(s.Head,{children:[e.jsx(s.HeadCell,{children:"Categoría"}),e.jsx(s.HeadCell,{children:"RUC"}),e.jsx(s.HeadCell,{children:"Razón Social"}),e.jsx(s.HeadCell,{children:"Nombres y Apellidos"}),e.jsx(s.HeadCell,{children:"DNI"}),e.jsx(s.HeadCell,{children:"Cargo"}),e.jsx(s.HeadCell,{children:"Email"})]}),e.jsx(s.Body,{className:"divide-y",children:a&&a.map(l=>e.jsx($,{cliente:l},l.id))})]})})}const G={tablist:{tabitem:{base:"flex items-center justify-center rounded-t-lg p-4 text-sm font-medium first:ml-0  disabled:cursor-not-allowed disabled:text-gray-400 disabled:dark:text-gray-500"}}};async function J(){return(await axios.get(route("clientes.registrados"))).data.registeredClients}async function K(){return(await axios.get(route("clientes.evaluados"))).data.evaluatedClients}async function Q(){const a=await axios.get(route("clientes.aprobados"));return console.log(a.data),a.data.approvedClients}const le=({auth:a,clientes:r,clientesPagos:l})=>{const[j,c]=i.useState([]),[x,h]=i.useState([]),[d,u]=i.useState([]);return i.useEffect(()=>{J().then(u),K().then(c),Q().then(h),console.log(d)},[]),e.jsx(H.Provider,{value:{clients:d,setClients:u},children:e.jsx(b.Provider,{value:{evaluatedClients:j,setEvaluatedClients:c},children:e.jsx(N.Provider,{value:{approvedClients:x,setApprovedClients:h},children:e.jsxs(P,{user:a.user,client:a.cliente,children:[e.jsx(k,{title:"Clientes"}),e.jsxs(f,{"aria-label":"Default tabs",style:"underline",theme:G,children:[e.jsx(f.Item,{active:!0,title:"Clientes Registrados",icon:y,children:e.jsxs("div",{className:"mt-4 container mx-auto",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Todos los clientes"}),e.jsx(I,{clientes:d})]})}),e.jsx(f.Item,{active:!0,title:"Clientes Evaluados",icon:y,children:e.jsxs("div",{className:"mt-4 container mx-auto",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Clientes Evaluados"}),e.jsx(U,{clientes:j})]})}),e.jsx(f.Item,{active:!0,title:"Clientes Aprobados",icon:y,children:e.jsxs("div",{className:"mt-4 container mx-auto",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Clientes Aprobados"}),e.jsx(L,{clientes:x})]})}),e.jsx(f.Item,{active:!0,title:"Pagos de Clientes",icon:M,children:e.jsxs("div",{className:"mt-4 container mx-auto",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Todos los clientes"}),e.jsx(V,{clientes:l})]})})]})]})})})})};export{le as default};
