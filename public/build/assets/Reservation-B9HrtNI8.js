import{r as s,R as q,q as h}from"./app-DzJNCemg.js";import{B as f,M as p,L as x,k,T as r}from"./Toast-DAXrZqWn.js";import"./jsx-runtime-CoOgG5aM.js";import{S as b}from"./sweetalert2.all-4F1A6Uy4.js";import{C as v}from"./Card-CYoVPnyf.js";import{M as I}from"./ModalObservacionesPago-CTW1WA4i.js";import{A as S}from"./AuthenticatedLayout-DpnaLYEW.js";import"./transition-Cbx_lerg.js";function N({time:e}){const[l,d]=s.useState(parseInt(e)*60*60);s.useEffect(()=>{if(l<=0)return;const o=setInterval(()=>{d(l-1)},1e3);return()=>clearInterval(o)},[l]);const u=Math.floor(l/3600),c=Math.floor(l%3600/60),n=l%60;return q.createElement("div",null,"Tiempo restante: ",u,":",c,":",n)}const w=({data:e,updatePaymentState:l})=>{const d=(c,n)=>{if(c!=null&&c.token){const o=c.token.id;console.log(o),b.fire({title:"Procesando...",text:"Por favor espera",allowOutsideClick:!1});const a={token:o,amount:n.amount,email:n.email,reservationId:n.reservationId,stands:n.stands};axios.post(route("culqui"),a).then(i=>{console.log(i);const m=i.data.message;b.close(),c.close(),m.object=="error"?b.fire({icon:"error",title:"¡Error! "+m.code,text:m.user_message}):(b.fire({icon:"success",title:"¡Éxito!",text:"El pago se realizó correctamente"}),l(!0))}).catch(i=>{c.close(),b.close(),b.fire({icon:"error",title:"Error",text:"Algo salió mal!",footer:`<a href>${i.response?i.response.data.message:""}</a>`}),console.log(i)})}else c.order?c.order:console.log("Error : ",c.error)},u=c=>{const n={title:"Culqi Store",currency:"PEN",amount:c.amount,order:"ord_live_0CjjdWhFpEAZlxlz"},o={tarjeta:!0,yape:!0,billetera:!1,bancaMovil:!1,agente:!1,cuotealo:!1},a={lang:"auto",installments:!1,modal:!0,container:"#culqi-container",paymentMethods:o,paymentMethodsSort:Object.keys(o)},i={theme:"default",hiddenCulqiLogo:!0,hiddenBannerContent:!0,hiddenBanner:!1,hiddenToolBarAmount:!0,menuType:"sidebar",buttonCardPayText:"Pagar ",logo:"http://localhost:8000/images/logo_gerepro.png",defaultStyle:{bannerColor:"black",buttonBackground:"black",menuColor:"white",linksColor:"white",buttonTextColor:"black",priceColor:"black"},variables:{fontFamily:"monospace",fontWeightNormal:"500",borderRadius:"8px",colorBackground:"#0A2540",colorPrimary:"#EFC078",colorPrimaryText:"#1A1B25",colorText:"white",colorTextSecondary:"white",colorTextPlaceholder:"#727F96",colorIconTab:"white",colorLogo:"dark"},rules:{".Culqi-Main-Container":{background:"#c8c8c8"},".Culqi-ToolBanner":{background:"#049DD9",color:"white"},".Culqi-Toolbar-Price":{color:"red"},".Culqi-Toolbar-Price .Culqi-Icon":{color:"blue"},".Culqi-Main-Method":{background:"white",padding:"10px 20px",color:"black"},".Culqi-Text-Link":{color:"red"},".Culqi-Text-Link .Culqi-Icon":{color:"blue"},".Culqi-message":{color:"blue"},".Culqi-message .Culqi-Icon":{color:"red"},".Culqi-message-warning":{background:"white",color:"orange"},".Culqi-message-info":{background:"white",color:"black"},".Culqi-message-error":{background:"black",color:"yellow"},".Culqi-message-error .Culqi-Icon":{color:"yellow"},".Culqi-Label":{color:"black",marginBottom:"15px","font-size":"0.8rem"},".Culqi-Input":{border:"1px solid gray",color:"black"},".Culqi-Input:focus":{border:"2px solid black"},".Culqi-Input.input-valid":{border:"1px solid pink",background:"#049DD9",color:"var(--colorText)"},".Culqi-Input-Icon-Spinner":{color:"red"},".Culqi-Input-Select":{border:"1px solid red",color:"blue"},".Culqi-Input-Select-Options-Hover":{color:"red",background:"black"},".Culqi-Input-Select-Selected":{color:"green"},".Culqi-Input-Select.active":{border:"1px solid red",background:"pink"},".Culqi-Input-Select-Options":{background:"gray"},".Culqi-Button":{background:"#049DD9"},".Culqi-Menu":{color:"black"},".Culqi-Menu .Culqi-Icon":{color:"green"},".Culqi-Menu-Selected":{color:"#D621A5"},".Culqi-Menu-Selected .Culqi-Icon":{color:"red"},".Culqi-Menu-Options":{background:"orange"},".Culqi-Menu-Options-Hover":{background:"green",color:"red"},".Culqi-Menu-Options-Hover .Culqi-Icon":{color:"blue"},".Culqi-Menu-Item.active":{color:"black","font-weight":"bold"},".Culqi-Menu-Item.active .Culqi-Icon":{color:"black","font-size":"2rem",height:"2rem"},".Culqi-Menu-Item-Text":{"font-size":"14px",color:"black"},".Culqi-Menu .Culqi-Icon-Arrow":{color:"blue"},".Culqi-Menu-Item.active .Culqi-Bar":{background:"blue",height:"3rem"}}},m={email:c.email},g="pk_test_d31d0bc237c6f16f",R={settings:n,client:m,options:a,appearance:i},t=new CulqiCheckout(g,R);t.culqi=()=>d(t,c),t.open()};return React.createElement(React.Fragment,null,React.createElement("div",{className:"flex-1 cursor-pointer px-3 py-1 border-4 border-gray-500 hover:border-cyan-500 rounded-md flex flex-col items-center",onClick:()=>u(e)},React.createElement("p",null,"Pago en linea"),React.createElement("div",{className:"flex"},React.createElement("img",{src:"/images/paymentMethods/credi-cards.png",alt:"logos de tarjetas de debito / credito",className:"flex-1"}),React.createElement("img",{src:"/images/paymentMethods/yape.png",alt:"logos de YAPE",className:"flex-1 h-16"}))))},M=({contractFile:e,stands:l,reservationId:d,updatePaymentState:u,setOpenModalPayment:c})=>{const[n,o]=s.useState(!1);s.useState("El pago no coincide"),s.useState("");const a=s.useRef(),i=()=>{const m=new FormData;m.append("stands",l),m.append("reservationId",d);const g=a.current.files[0];m.append("file",g),m.append("contractFile",e),axios.post(route("pagar"),m).then(R=>{R.status==200?(b.fire({position:"center",icon:"success",title:R.data.mensaje,showConfirmButton:!1,timer:1500}),u(!0),o(!1),c(!1)):console.error("Ah ocurrido un error al pagar:",R)}).catch(R=>{console.error("No se recibió ninguna respuesta:",R)})};return React.createElement(React.Fragment,null,React.createElement(f,{onClick:()=>o(!0),color:"light",className:"flex-1 px-3 py-1 bg-transparent text-black border-4 border-gray-500 hover:border-cyan-500 hover:bg-transparent button_payment_by_transfer"},React.createElement("div",{className:"flex flex-col h-full justify-around"},React.createElement("p",{className:"text-base"},"Pagar por Transferencia"),React.createElement("img",{src:"/images/paymentMethods/banks.jpg",alt:"logos bancos",className:"h-16"}))),React.createElement(p,{show:n,onClose:()=>o(!1)},React.createElement(p.Header,null,"Transferencia Bancaria"),React.createElement(p.Body,null,React.createElement("div",{className:""},React.createElement("h4",{className:""},"Cuentas Bancarias"),React.createElement("ul",{className:"flex justify-between"},React.createElement("li",null,"Banco de la Nación:",React.createElement("ul",null,React.createElement("li",null,"Número de cuenta: 12345XXXX"),React.createElement("li",null,"Código de cuenta interbancario (CCI): ABC123"))),React.createElement("li",null,"Banco Interbank:",React.createElement("ul",null,React.createElement("li",null,"Número de cuenta: 09876XXX"),React.createElement("li",null,"Código de cuenta interbancario (CCI): XYZ456")))),React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"my-2 block"},React.createElement(x,{htmlFor:"file-upload",value:"Adjunte el voucher de pago"}),React.createElement("span",{className:"text-red-600"},"(Solo PDF y JPG permitidos)")),React.createElement(k,{id:"file-upload",ref:a})))),React.createElement(p.Footer,null,React.createElement("div",{className:"flex justify-between w-full"},React.createElement(f,{color:"success",onClick:i},"Pagar"),React.createElement(f,{color:"failure",onClick:()=>o(!1)},"Cancelar")))))};function F({stands:e,reservationId:l,updatePaymentState:d}){s.useRef();const u=s.useRef(),[c,n]=s.useState(!1),{auth:o}=h().props;s.useState(null);const[a,i]=s.useState(null),[m,g]=s.useState({});s.useEffect(()=>{const t=o.cliente,E={amount:e.reduce((y,P)=>y+P.price,0)*100,email:t.email,name:t.company_name?t.company_name:t.name+" "+t.last_name,stands:e,reservationId:l};g(E)},[]);const R=t=>{i(t.target.files[0])};return s.useEffect(()=>{if(a){const t=a.name.split(".").pop();t!=="pdf"&&t!=="jpg"&&(i(null),alert("Solo se permiten archivos PDF y JPG"))}},[a]),React.createElement(React.Fragment,null,React.createElement(f,{onClick:()=>n(!0)},"Pagar"),React.createElement(p,{dismissible:!0,show:c,onClose:()=>{n(!1),i(null)},size:"7xl"},React.createElement(p.Header,null,"Estás a punto de pagar por este stand. Por favor, confirma que todos los detalles son correctos antes de proceder."),React.createElement(p.Body,null,React.createElement("div",{className:"mt-0"},React.createElement(N,{time:2})),React.createElement("div",{className:"grid grid-cols-5 gap-1"},React.createElement("div",{className:"col-span-2 flex flex-col border-r-2 border-gray-500"},React.createElement("h4",null,"Información de la Reserva"),React.createElement("div",{className:"space-y-3"},React.createElement("p",null,"usuario: ",o.cliente.name,o.cliente.last_name),React.createElement("p",null,"Categoría: ",e[0].category.name)),React.createElement("div",{className:"overflow-x-auto mt-2"},React.createElement("p",null,"Información de los stands"),React.createElement(r,{striped:!0},React.createElement(r.Head,null,React.createElement(r.HeadCell,null,"Bloque"),React.createElement(r.HeadCell,null,"Stand"),React.createElement(r.HeadCell,{align:"end"},"precio")),React.createElement(r.Body,{className:"divide-y"},e&&e.map(t=>React.createElement(r.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",id:t.name,key:t.id},React.createElement(r.Cell,null,t.block),React.createElement(r.Cell,null,t.name),React.createElement(r.Cell,{align:"end"},t.price))))),React.createElement("div",{className:"flex justify-between px-8"},React.createElement("div",{className:""},React.createElement("p",null,"Cantidad: ",e.length," ")),React.createElement("div",{className:""},React.createElement("p",null,"Total:"," ",e.reduce((t,C)=>t+C.price,0)))))),React.createElement("div",{className:"col-span-3 flex-2 pl-2"},React.createElement("div",{className:""},React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"my-2 block"},React.createElement(x,{htmlFor:"file-voucher_upload",value:"Adjunte el contrato firmado "}),React.createElement("span",{className:"text-red-600"},"(Solo PDF y JPG permitidos)")),React.createElement(k,{onChange:R,id:"contract-file-upload",ref:u,accept:".pdf,.jpg"}))),a&&React.createElement("div",{className:"justify-around mt-4"},React.createElement("p",{className:"mb-4 font-bold text-xl"},"Elija el método de pago"),React.createElement("div",{className:"w-full flex justify-center"},React.createElement("div",{className:"flex justify-center gap-8"},React.createElement(w,{data:m,updatePaymentState:d}),React.createElement(M,{contractFile:a,stands:e,reservationId:l,updatePaymentState:d,setOpenModalPayment:n})))))))))}function B({stands:e,payment:l}){var n,o;const[d,u]=s.useState(!1),{auth:c}=h().props;return React.createElement(React.Fragment,null,React.createElement(f,{onClick:()=>u(!0)},"Ver"),React.createElement(p,{dismissible:!0,show:d,onClose:()=>u(!1)},React.createElement(p.Header,null,"Stands Reservados"),React.createElement(p.Body,null,React.createElement("div",{className:"space-y-6"},React.createElement("p",null,"usuario: ",c.cliente.name," ",c.cliente.last_name),React.createElement("p",null,"Categoría: ",(o=(n=e[0])==null?void 0:n.category)==null?void 0:o.name)),e&&e.map(a=>React.createElement(v,{className:"m-1 card_padding px-8",key:a.id},React.createElement("div",{className:"flex justify-between"},React.createElement("p",null,"bloque : ",a.block),React.createElement("p",null,"Stand : ",a.name),React.createElement("p",null,"precio : ",a.price)))),React.createElement("div",{className:"flex justify-between p-8"},React.createElement("div",{className:""},React.createElement("p",null,"Cantidad: ",e.length," ")),React.createElement("div",{className:""},React.createElement("p",null,"Total:"," ",e.reduce((a,i)=>a+i.price,0)))),l&&l.file&&React.createElement("div",{className:""},React.createElement("p",null,"pagado"),(()=>{const a=l.file.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(a)?React.createElement("img",{src:`http://localhost:8000/storage/${l.file}`,alt:"Payment"}):a==="pdf"?React.createElement("embed",{src:`http://localhost:8000/storage/${l.file}`,type:"application/pdf",width:"100%",height:"600px"}):React.createElement("p",null,"Archivo no soportado")})())),React.createElement(p.Footer,{className:""},React.createElement(f,{color:"gray",onClick:()=>u(!1)},"cerrar"))))}function j({stands:e,reservationId:l,updatePaymentState:d,updatePayment:u,updatePaymentVerified:c}){const n=s.useRef(),[o,a]=s.useState(!1),{auth:i}=h().props,[m,g]=s.useState(null),R=()=>{const t=new FormData;t.append("stands",e),t.append("reservationId",l);const C=n.current.files[0];t.append("file",C),axios.post(route("payment.update"),t).then(E=>{E.status==200?(g("Pago corregido con éxito"),d(!0),a(!1),u({file:E.data.file}),c("corregido")):console.error("Ah ocurrido un error al pagar:",E)}).catch(E=>{console.error("No se recibió ninguna respuesta:",E.request)})};return React.createElement(React.Fragment,null,React.createElement(f,{onClick:()=>a(!0)},"Corregir Pago"),React.createElement(p,{dismissible:!0,show:o,onClose:()=>a(!1),size:"4xl"},React.createElement(p.Header,null,"Estás a punto de corregir este pago. Por favor, confirma que todos los detalles son correctos antes de proceder."),React.createElement(p.Body,null,m&&React.createElement("p",null,m),!m&&React.createElement(React.Fragment,null,React.createElement("div",{className:"space-y-6"},React.createElement("p",null,"usuario: ",i.cliente.name," ",i.cliente.last_name),React.createElement("p",null,"Categoría: ",e[0].category.name)),e&&e.map(t=>React.createElement(v,{className:"m-1 card_padding px-8",key:t.id},React.createElement("div",{className:"flex justify-between"},React.createElement("p",null,"bloque : ",t.block),React.createElement("p",null,"Stand : ",t.name),React.createElement("p",null,"precio : ",t.price)))),React.createElement("div",{className:"flex justify-between p-8"},React.createElement("div",{className:""},React.createElement("p",null,"Cantidad: ",e.length," ")),React.createElement("div",{className:""},React.createElement("p",null,"Total:"," ",e.reduce((t,C)=>t+C.price,0)))),React.createElement("div",{className:""},React.createElement("div",null,React.createElement("h2",null,"Bancos"),React.createElement("ul",{className:"flex justify-between"},React.createElement("li",null,"Banco de la Nación:",React.createElement("ul",null,React.createElement("li",null,"Número de cuenta: 1234567890"),React.createElement("li",null,"Código de cuenta interbancario (CCI): ABC123"))),React.createElement("li",null,"Banco Interbank:",React.createElement("ul",null,React.createElement("li",null,"Número de cuenta: 0987654321"),React.createElement("li",null,"Código de cuenta interbancario (CCI): XYZ456")))))),React.createElement("div",{className:""},React.createElement(N,{time:2})),React.createElement("div",{className:"mt-2"},React.createElement("div",{className:"my-2 block"},React.createElement(x,{htmlFor:"file-upload",value:"Adjunte el voucher de pago"}),React.createElement("span",{className:"text-red-600"},"(Solo PDF y JPG permitidos)")),React.createElement(k,{id:"file-upload",ref:n})))),!m&&React.createElement(p.Footer,{className:""},React.createElement(f,{onClick:R},"Pagar"),React.createElement(f,{color:"gray",onClick:()=>a(!1)},"Cancelar"))))}const _=({reservation:e})=>{var R,t,C;const[l,d]=s.useState(!!e.enable),[u,c]=s.useState(!!e.payment),[n,o]=s.useState(((C=(t=(R=e.payment)==null?void 0:R.payment_status)==null?void 0:t[e.payment.payment_status.length-1])==null?void 0:C.status)||!1),[a,i]=s.useState(e.payment),m=E=>{i(y=>({...y,...E}))},g=()=>{axios.delete(route("reservaciones.eliminar"),{data:{id:e.id}}).then(E=>{E.status==200&&d(!1)}).catch(E=>{log(E)})};return React.createElement(r.Row,{key:e.id,className:"bg-white dark:border-gray-700 dark:bg-gray-800"},React.createElement(r.Cell,null,e.date),React.createElement(r.Cell,null,e.total),React.createElement(r.Cell,null,React.createElement("div",{className:"flex justify-center gap-5"},React.createElement(B,{stands:e.stands,payment:a}),!u&&l&&React.createElement(F,{stands:e.stands,reservationId:e.id,updatePaymentState:c}),!u&&l&&React.createElement(f,{color:"failure",onClick:g},"Anular Reserva"))),React.createElement(r.Cell,{align:"center"},u?n=="aceptado"?React.createElement("span",{className:"text-green-500"},"Aceptado"):n=="observado"?React.createElement("div",{className:""},React.createElement("span",{className:"text-red-800"},"Observado"),React.createElement(I,{paymentStatus:a.payment_status[a.payment_status.length-1]}),React.createElement(j,{stands:e.stands,reservationId:e.id,updatePaymentState:c,updatePayment:m,updatePaymentVerified:o})):React.createElement("span",{className:"text-green-500"},n):l?"pendiente de pago":"Reserva Anulada"),React.createElement(r.Cell,{align:"center"},React.createElement("div",{className:"flex flex-col gap-2"},u&&n=="aceptado"&&React.createElement(React.Fragment,null,React.createElement(f,{as:"a",href:route("generateFotoCheckPDF",{clientId:e.cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Credenciales"),React.createElement(f,{as:"a",href:route("generateInvoicePDF",{clientId:e.cliente_id,reservationId:e.id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Recibo")),e&&React.createElement(f,{as:"a",href:route("generateContractPDF",{clientId:e.cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary"},"Contrato"))))};function V({auth:e,reservations:l}){return React.createElement(S,{user:e.user,client:e.cliente},React.createElement("div",{className:"overflow-x-auto container mx-auto"},React.createElement(r,{striped:!0},React.createElement(r.Head,null,React.createElement(r.HeadCell,null,"fecha"),React.createElement(r.HeadCell,null,"total"),React.createElement(r.HeadCell,{className:"flex justify-center"},"Opciones"),React.createElement(r.HeadCell,{align:"center"},"Estado del Pago"),React.createElement(r.HeadCell,{align:"center"},"Documentos")),React.createElement(r.Body,{className:"divide-y"},l&&l.map((d,u)=>React.createElement(_,{reservation:d,key:d.id}))))))}export{V as default};
