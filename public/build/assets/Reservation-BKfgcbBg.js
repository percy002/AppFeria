import{r as i,j as e,q as v}from"./app-CC0jckWs.js";import{B as f,M as p,L as k,k as N,T as t}from"./Toast-CZeBGyVr.js";import{S as b}from"./sweetalert2.all-Bi5WDZWc.js";import{C as P}from"./Card-D0LgPL7A.js";import{M as S}from"./ModalObservacionesPago-DyFkhUtd.js";import{A as w}from"./AuthenticatedLayout-DWXZgT2M.js";import"./transition-B4Xjgr4-.js";function q({time:l}){const[r,h]=i.useState(parseInt(l)*60*60);i.useEffect(()=>{if(r<=0)return;const c=setInterval(()=>{h(r-1)},1e3);return()=>clearInterval(c)},[r]);const x=Math.floor(r/3600),n=Math.floor(r%3600/60),o=r%60;return e.jsxs("div",{children:["Tiempo restante: ",x,":",n,":",o]})}const M=({data:l,updatePaymentState:r})=>{const h=(n,o)=>{if(n!=null&&n.token){const c=n.token.id;console.log(c),b.fire({title:"Procesando...",text:"Por favor espera",allowOutsideClick:!1});const a={token:c,amount:o.amount,email:o.email,reservationId:o.reservationId,stands:o.stands};axios.post(route("culqui"),a).then(d=>{console.log(d);const u=d.data.message;b.close(),n.close(),u.object=="error"?b.fire({icon:"error",title:"¡Error! "+u.code,text:u.user_message}):(b.fire({icon:"success",title:"¡Éxito!",text:"El pago se realizó correctamente"}),r(!0))}).catch(d=>{n.close(),b.close(),b.fire({icon:"error",title:"Error",text:"Algo salió mal!",footer:`<a href>${d.response?d.response.data.message:""}</a>`}),console.log(d)})}else n.order?n.order:console.log("Error : ",n.error)},x=n=>{const o={title:"Culqi Store",currency:"PEN",amount:n.amount,order:"ord_live_0CjjdWhFpEAZlxlz"},c={tarjeta:!0,yape:!0,billetera:!1,bancaMovil:!1,agente:!1,cuotealo:!1},a={lang:"auto",installments:!1,modal:!0,container:"#culqi-container",paymentMethods:c,paymentMethodsSort:Object.keys(c)},d={theme:"default",hiddenCulqiLogo:!0,hiddenBannerContent:!0,hiddenBanner:!1,hiddenToolBarAmount:!0,menuType:"sidebar",buttonCardPayText:"Pagar ",logo:"http://localhost:8000/images/logo_gerepro.png",defaultStyle:{bannerColor:"black",buttonBackground:"black",menuColor:"white",linksColor:"white",buttonTextColor:"black",priceColor:"black"},variables:{fontFamily:"monospace",fontWeightNormal:"500",borderRadius:"8px",colorBackground:"#0A2540",colorPrimary:"#EFC078",colorPrimaryText:"#1A1B25",colorText:"white",colorTextSecondary:"white",colorTextPlaceholder:"#727F96",colorIconTab:"white",colorLogo:"dark"},rules:{".Culqi-Main-Container":{background:"#c8c8c8"},".Culqi-ToolBanner":{background:"#049DD9",color:"white"},".Culqi-Toolbar-Price":{color:"red"},".Culqi-Toolbar-Price .Culqi-Icon":{color:"blue"},".Culqi-Main-Method":{background:"white",padding:"10px 20px",color:"black"},".Culqi-Text-Link":{color:"red"},".Culqi-Text-Link .Culqi-Icon":{color:"blue"},".Culqi-message":{color:"blue"},".Culqi-message .Culqi-Icon":{color:"red"},".Culqi-message-warning":{background:"white",color:"orange"},".Culqi-message-info":{background:"white",color:"black"},".Culqi-message-error":{background:"black",color:"yellow"},".Culqi-message-error .Culqi-Icon":{color:"yellow"},".Culqi-Label":{color:"black",marginBottom:"15px","font-size":"0.8rem"},".Culqi-Input":{border:"1px solid gray",color:"black"},".Culqi-Input:focus":{border:"2px solid black"},".Culqi-Input.input-valid":{border:"1px solid pink",background:"#049DD9",color:"var(--colorText)"},".Culqi-Input-Icon-Spinner":{color:"red"},".Culqi-Input-Select":{border:"1px solid red",color:"blue"},".Culqi-Input-Select-Options-Hover":{color:"red",background:"black"},".Culqi-Input-Select-Selected":{color:"green"},".Culqi-Input-Select.active":{border:"1px solid red",background:"pink"},".Culqi-Input-Select-Options":{background:"gray"},".Culqi-Button":{background:"#049DD9"},".Culqi-Menu":{color:"black"},".Culqi-Menu .Culqi-Icon":{color:"green"},".Culqi-Menu-Selected":{color:"#D621A5"},".Culqi-Menu-Selected .Culqi-Icon":{color:"red"},".Culqi-Menu-Options":{background:"orange"},".Culqi-Menu-Options-Hover":{background:"green",color:"red"},".Culqi-Menu-Options-Hover .Culqi-Icon":{color:"blue"},".Culqi-Menu-Item.active":{color:"black","font-weight":"bold"},".Culqi-Menu-Item.active .Culqi-Icon":{color:"black","font-size":"2rem",height:"2rem"},".Culqi-Menu-Item-Text":{"font-size":"14px",color:"black"},".Culqi-Menu .Culqi-Icon-Arrow":{color:"blue"},".Culqi-Menu-Item.active .Culqi-Bar":{background:"blue",height:"3rem"}}},u={email:n.email},g="pk_test_d31d0bc237c6f16f",m={settings:o,client:u,options:a,appearance:d},s=new CulqiCheckout(g,m);s.culqi=()=>h(s,n),s.open()};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex-1 cursor-pointer px-3 py-1 border-4 border-gray-500 hover:border-cyan-500 rounded-md flex flex-col items-center",onClick:()=>x(l),children:[e.jsx("p",{children:"Pago en linea"}),e.jsxs("div",{className:"flex",children:[e.jsx("img",{src:"/images/paymentMethods/credi-cards.png",alt:"logos de tarjetas de debito / credito",className:"flex-1"}),e.jsx("img",{src:"/images/paymentMethods/yape.png",alt:"logos de YAPE",className:"flex-1 h-16"})]})]})})},F=({contractFile:l,stands:r,reservationId:h,updatePaymentState:x,setOpenModalPayment:n})=>{const[o,c]=i.useState(!1);i.useState("El pago no coincide"),i.useState("");const a=i.useRef(),d=()=>{const u=new FormData;u.append("stands",r),u.append("reservationId",h);const g=a.current.files[0];u.append("file",g),u.append("contractFile",l),axios.post(route("pagar"),u).then(m=>{m.status==200?(b.fire({position:"center",icon:"success",title:m.data.mensaje,showConfirmButton:!1,timer:1500}),x(!0),c(!1),n(!1)):console.error("Ah ocurrido un error al pagar:",m)}).catch(m=>{console.error("No se recibió ninguna respuesta:",m)})};return e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:()=>c(!0),color:"light",className:"flex-1 px-3 py-1 bg-transparent text-black border-4 border-gray-500 hover:border-cyan-500 hover:bg-transparent button_payment_by_transfer",children:e.jsxs("div",{className:"flex flex-col h-full justify-around",children:[e.jsx("p",{className:"text-base",children:"Pagar por Transferencia"}),e.jsx("img",{src:"/images/paymentMethods/banks.jpg",alt:"logos bancos",className:"h-16"})]})}),e.jsxs(p,{show:o,onClose:()=>c(!1),children:[e.jsx(p.Header,{children:"Transferencia Bancaria"}),e.jsx(p.Body,{children:e.jsxs("div",{className:"",children:[e.jsx("h4",{className:"",children:"Cuentas Bancarias"}),e.jsxs("ul",{className:"flex justify-between",children:[e.jsxs("li",{children:["Banco de la Nación:",e.jsxs("ul",{children:[e.jsx("li",{children:"Número de cuenta: 12345XXXX"}),e.jsx("li",{children:"Código de cuenta interbancario (CCI): ABC123"})]})]}),e.jsxs("li",{children:["Banco Interbank:",e.jsxs("ul",{children:[e.jsx("li",{children:"Número de cuenta: 09876XXX"}),e.jsx("li",{children:"Código de cuenta interbancario (CCI): XYZ456"})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"my-2 block",children:[e.jsx(k,{htmlFor:"file-upload",value:"Adjunte el voucher de pago"}),e.jsx("span",{className:"text-red-600",children:"(Solo PDF y JPG permitidos)"})]}),e.jsx(N,{id:"file-upload",ref:a})]})]})}),e.jsx(p.Footer,{children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx(f,{color:"success",onClick:d,children:"Pagar"}),e.jsx(f,{color:"failure",onClick:()=>c(!1),children:"Cancelar"})]})})]})]})};function B({stands:l,reservationId:r,updatePaymentState:h}){i.useRef();const x=i.useRef(),[n,o]=i.useState(!1),{auth:c}=v().props;i.useState(null);const[a,d]=i.useState(null),[u,g]=i.useState({});i.useEffect(()=>{const s=c.cliente,j={amount:l.reduce((y,I)=>y+I.price,0)*100,email:s.email,name:s.company_name?s.company_name:s.name+" "+s.last_name,stands:l,reservationId:r};g(j)},[]);const m=s=>{d(s.target.files[0])};return i.useEffect(()=>{if(a){const s=a.name.split(".").pop();s!=="pdf"&&s!=="jpg"&&(d(null),alert("Solo se permiten archivos PDF y JPG"))}},[a]),e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:()=>o(!0),children:"Pagar"}),e.jsxs(p,{dismissible:!0,show:n,onClose:()=>{o(!1),d(null)},size:"7xl",children:[e.jsx(p.Header,{children:"Estás a punto de pagar por este stand. Por favor, confirma que todos los detalles son correctos antes de proceder."}),e.jsxs(p.Body,{children:[e.jsx("div",{className:"mt-0",children:e.jsx(q,{time:2})}),e.jsxs("div",{className:"grid grid-cols-5 gap-1",children:[e.jsxs("div",{className:"col-span-2 flex flex-col border-r-2 border-gray-500",children:[e.jsx("h4",{children:"Información de la Reserva"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:["usuario: ",c.cliente.name,c.cliente.last_name]}),e.jsxs("p",{children:["Categoría: ",l[0].category.name]})]}),e.jsxs("div",{className:"overflow-x-auto mt-2",children:[e.jsx("p",{children:"Información de los stands"}),e.jsxs(t,{striped:!0,children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Bloque"}),e.jsx(t.HeadCell,{children:"Stand"}),e.jsx(t.HeadCell,{align:"end",children:"precio"})]}),e.jsx(t.Body,{className:"divide-y",children:l&&l.map(s=>e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",id:s.name,children:[e.jsx(t.Cell,{children:s.block}),e.jsx(t.Cell,{children:s.name}),e.jsx(t.Cell,{align:"end",children:s.price})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between px-8",children:[e.jsx("div",{className:"",children:e.jsxs("p",{children:["Cantidad: ",l.length," "]})}),e.jsx("div",{className:"",children:e.jsxs("p",{children:["Total:"," ",l.reduce((s,C)=>s+C.price,0)]})})]})]})]}),e.jsxs("div",{className:"col-span-3 flex-2 pl-2",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"my-2 block",children:[e.jsx(k,{htmlFor:"file-voucher_upload",value:"Adjunte el contrato firmado "}),e.jsx("span",{className:"text-red-600",children:"(Solo PDF y JPG permitidos)"})]}),e.jsx(N,{onChange:m,id:"contract-file-upload",ref:x,accept:".pdf,.jpg"})]})}),a&&e.jsxs("div",{className:"justify-around mt-4",children:[e.jsx("p",{className:"mb-4 font-bold text-xl",children:"Elija el método de pago"}),e.jsx("div",{className:"w-full flex justify-center",children:e.jsxs("div",{className:"flex justify-center gap-8",children:[e.jsx(M,{data:u,updatePaymentState:h}),e.jsx(F,{contractFile:a,stands:l,reservationId:r,updatePaymentState:h,setOpenModalPayment:o})]})})]})]})]})]})]})]})}function _({stands:l,payment:r}){var o,c;const[h,x]=i.useState(!1),{auth:n}=v().props;return e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:()=>x(!0),children:"Ver"}),e.jsxs(p,{dismissible:!0,show:h,onClose:()=>x(!1),children:[e.jsx(p.Header,{children:"Stands Reservados"}),e.jsxs(p.Body,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{children:["usuario: ",n.cliente.name," ",n.cliente.last_name]}),e.jsxs("p",{children:["Categoría: ",(c=(o=l[0])==null?void 0:o.category)==null?void 0:c.name]})]}),l&&l.map(a=>e.jsx(P,{className:"m-1 card_padding px-8",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("p",{children:["bloque : ",a.block]}),e.jsxs("p",{children:["Stand : ",a.name]}),e.jsxs("p",{children:["precio : ",a.price]})]})},a.id)),e.jsxs("div",{className:"flex justify-between p-8",children:[e.jsx("div",{className:"",children:e.jsxs("p",{children:["Cantidad: ",l.length," "]})}),e.jsx("div",{className:"",children:e.jsxs("p",{children:["Total:"," ",l.reduce((a,d)=>a+d.price,0)]})})]}),r&&r.file&&e.jsxs("div",{className:"",children:[e.jsx("p",{children:"pagado"}),(()=>{const a=r.file.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(a)?e.jsx("img",{src:`http://localhost:8000/storage/${r.file}`,alt:"Payment"}):a==="pdf"?e.jsx("embed",{src:`http://localhost:8000/storage/${r.file}`,type:"application/pdf",width:"100%",height:"600px"}):e.jsx("p",{children:"Archivo no soportado"})})()]})]}),e.jsx(p.Footer,{className:"",children:e.jsx(f,{color:"gray",onClick:()=>x(!1),children:"cerrar"})})]})]})}function T({stands:l,reservationId:r,updatePaymentState:h,updatePayment:x,updatePaymentVerified:n}){const o=i.useRef(),[c,a]=i.useState(!1),{auth:d}=v().props,[u,g]=i.useState(null),m=()=>{const s=new FormData;s.append("stands",l),s.append("reservationId",r);const C=o.current.files[0];s.append("file",C),axios.post(route("payment.update"),s).then(j=>{j.status==200?(g("Pago corregido con éxito"),h(!0),a(!1),x({file:j.data.file}),n("corregido")):console.error("Ah ocurrido un error al pagar:",j)}).catch(j=>{console.error("No se recibió ninguna respuesta:",j.request)})};return e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:()=>a(!0),children:"Corregir Pago"}),e.jsxs(p,{dismissible:!0,show:c,onClose:()=>a(!1),size:"4xl",children:[e.jsx(p.Header,{children:"Estás a punto de corregir este pago. Por favor, confirma que todos los detalles son correctos antes de proceder."}),e.jsxs(p.Body,{children:[u&&e.jsx("p",{children:u}),!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{children:["usuario: ",d.cliente.name," ",d.cliente.last_name]}),e.jsxs("p",{children:["Categoría: ",l[0].category.name]})]}),l&&l.map(s=>e.jsx(P,{className:"m-1 card_padding px-8",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("p",{children:["bloque : ",s.block]}),e.jsxs("p",{children:["Stand : ",s.name]}),e.jsxs("p",{children:["precio : ",s.price]})]})},s.id)),e.jsxs("div",{className:"flex justify-between p-8",children:[e.jsx("div",{className:"",children:e.jsxs("p",{children:["Cantidad: ",l.length," "]})}),e.jsx("div",{className:"",children:e.jsxs("p",{children:["Total:"," ",l.reduce((s,C)=>s+C.price,0)]})})]}),e.jsx("div",{className:"",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Bancos"}),e.jsxs("ul",{className:"flex justify-between",children:[e.jsxs("li",{children:["Banco de la Nación:",e.jsxs("ul",{children:[e.jsx("li",{children:"Número de cuenta: 1234567890"}),e.jsx("li",{children:"Código de cuenta interbancario (CCI): ABC123"})]})]}),e.jsxs("li",{children:["Banco Interbank:",e.jsxs("ul",{children:[e.jsx("li",{children:"Número de cuenta: 0987654321"}),e.jsx("li",{children:"Código de cuenta interbancario (CCI): XYZ456"})]})]})]})]})}),e.jsx("div",{className:"",children:e.jsx(q,{time:2})}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"my-2 block",children:[e.jsx(k,{htmlFor:"file-upload",value:"Adjunte el voucher de pago"}),e.jsx("span",{className:"text-red-600",children:"(Solo PDF y JPG permitidos)"})]}),e.jsx(N,{id:"file-upload",ref:o})]})]})]}),!u&&e.jsxs(p.Footer,{className:"",children:[e.jsx(f,{onClick:m,children:"Pagar"}),e.jsx(f,{color:"gray",onClick:()=>a(!1),children:"Cancelar"})]})]})]})}const A=({reservation:l})=>{var m,s,C;const[r,h]=i.useState(!!l.enable),[x,n]=i.useState(!!l.payment),[o,c]=i.useState(((C=(s=(m=l.payment)==null?void 0:m.payment_status)==null?void 0:s[l.payment.payment_status.length-1])==null?void 0:C.status)||!1),[a,d]=i.useState(l.payment),u=j=>{d(y=>({...y,...j}))},g=()=>{axios.delete(route("reservaciones.eliminar"),{data:{id:l.id}}).then(j=>{j.status==200&&h(!1)}).catch(j=>{log(j)})};return e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(t.Cell,{children:l.date}),e.jsx(t.Cell,{children:l.total}),e.jsx(t.Cell,{children:e.jsxs("div",{className:"flex justify-center gap-5",children:[e.jsx(_,{stands:l.stands,payment:a}),!x&&r&&e.jsx(B,{stands:l.stands,reservationId:l.id,updatePaymentState:n}),!x&&r&&e.jsx(f,{color:"failure",onClick:g,children:"Anular Reserva"})]})}),e.jsx(t.Cell,{align:"center",children:x?o=="aceptado"?e.jsx("span",{className:"text-green-500",children:"Aceptado"}):o=="observado"?e.jsxs("div",{className:"",children:[e.jsx("span",{className:"text-red-800",children:"Observado"}),e.jsx(S,{paymentStatus:a.payment_status[a.payment_status.length-1]}),e.jsx(T,{stands:l.stands,reservationId:l.id,updatePaymentState:n,updatePayment:u,updatePaymentVerified:c})]}):e.jsx("span",{className:"text-green-500",children:o}):r?"pendiente de pago":"Reserva Anulada"}),e.jsx(t.Cell,{align:"center",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x&&o=="aceptado"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{as:"a",href:route("generateFotoCheckPDF",{clientId:l.cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Credenciales"}),e.jsx(f,{as:"a",href:route("generateInvoicePDF",{clientId:l.cliente_id,reservationId:l.id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Recibo"})]}),l&&e.jsx(f,{as:"a",href:route("generateContractPDF",{clientId:l.cliente_id}),target:"_blank",rel:"noopener noreferrer",variant:"primary",children:"Contrato"})]})})]},l.id)};function z({auth:l,reservations:r}){return e.jsx(w,{user:l.user,client:l.cliente,children:e.jsx("div",{className:"overflow-x-auto container mx-auto",children:e.jsxs(t,{striped:!0,children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"fecha"}),e.jsx(t.HeadCell,{children:"total"}),e.jsx(t.HeadCell,{className:"flex justify-center",children:"Opciones"}),e.jsx(t.HeadCell,{align:"center",children:"Estado del Pago"}),e.jsx(t.HeadCell,{align:"center",children:"Documentos"})]}),e.jsx(t.Body,{className:"divide-y",children:r&&r.map((h,x)=>e.jsx(A,{reservation:h},h.id))})]})})})}export{z as default};
